FROM alpine:latest AS builder

WORKDIR /tmp

COPY hadoop-*.tar.gz .
RUN tar -zxvf hadoop-*.tar.gz -C /

COPY jdk-* .
RUN tar -zxvf jdk-*.tar.gz -C /

FROM ubuntu:latest

ARG PASSWORD

RUN useradd hadoop -m -d /home/hadoop -s /bin/bash -p "${PASSWORD}"

USER hadoop

WORKDIR /home/hadoop

COPY --from=builder /hadoop-* hadoop-current
COPY --from=builder /jdk-* /opt/java

RUN mkdir -p cluster-data/hadoop/logs cluster-data/hadoop/pids

ENV PATH="/opt/java/bin:/home/hadoop/hadoop-current/bin:/home/hadoop/hadoop-current/sbin:${PATH}"
ENV JAVA_HOME='/opt/java'
ENV HADOOP_LOG_DIR='/home/hadoop/cluster-data/hadoop/logs'
ENV HADOOP_PID_DIR='/home/hadoop/cluster-data/hadoop/pids'

CMD ["/usr/bin/bash"]
